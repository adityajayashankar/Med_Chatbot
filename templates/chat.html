<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyla - Medical Chatbot</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind Typography Plugin for message formatting -->
    <script src="https://cdn.tailwindcss.com/3.4.1?plugins=typography"></script>
    <!-- Google Fonts: Google Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Custom styles for the chatbot */
        body {
            font-family: 'Google Sans', sans-serif;
            background-color: #1b1c1d;
            color: #E0E0E0;
        }
        /* Custom scrollbar for a cleaner look in dark mode */
        #chat-window::-webkit-scrollbar {
            width: 8px;
        }
        #chat-window::-webkit-scrollbar-track {
            background: #1b1c1d;
        }
        #chat-window::-webkit-scrollbar-thumb {
            background: #3a3b3c;
            border-radius: 4px;
        }
        #chat-window::-webkit-scrollbar-thumb:hover {
            background: #4b4c4d;
        }
        /* Ensure the chat container fills the viewport and enables scrolling */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 100vh;
        }
        /* Override typography plugin color for our custom theme */
        .prose-invert {
            --tw-prose-body: #E0E0E0;
            --tw-prose-headings: #E0E0E0;
            --tw-prose-lead: #E0E0E0;
            --tw-prose-links: #E0E0E0;
            --tw-prose-bold: #E0E0E0;
            --tw-prose-counters: #E0E0E0;
            --tw-prose-bullets: #E0E0E0;
        }
    </style>
</head>
<body>

    <!-- Chatbot Container -->
    <div class="chat-container bg-[#1b1c1d] w-full mx-auto">

        <!-- Header - Now sticky -->
        <header class="sticky top-0 z-10 bg-[#1b1c1d] p-4 px-6 border-b border-white/10 flex justify-between items-center">
            <!-- Left Side: Title and Model Selector -->
            <div class="flex flex-col items-start">
                <h1 class="text-xl font-semibold text-[#E0E0E0] mb-2 flex items-center gap-2">
                    <i class="fa-solid fa-heart-pulse text-red-400"></i>
                    <span>Nyla</span>
                </h1>
                <div class="relative">
                    <button id="model-selector-btn" class="flex items-center gap-2 px-3 py-1 bg-[#272829] hover:bg-[#3a3b3c] rounded-lg text-sm transition-colors">
                        <span id="selected-model" class="text-[#B0B0B0] font-bold">llama3-70b-8192</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><path d="m6 9 6 6 6-6"/></svg>
                    </button>
                    <div id="model-dropdown" class="hidden absolute left-0 mt-2 w-48 bg-[#272829] border border-white/10 rounded-lg shadow-lg z-20">
                        <a href="#" class="model-option flex items-center justify-between px-4 py-2 text-sm font-bold text-[#E0E0E0] hover:bg-[#3a3b3c]"><span>Gemini 2.5 Pro</span><span class="font-bold text-lg">G</span></a>
                        <a href="#" class="model-option flex items-center justify-between px-4 py-2 text-sm font-bold text-[#E0E0E0] hover:bg-[#3a3b3c]">
                            <span>GPT-4o</span>
                            <svg class="w-5 h-5" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M35.5 11.5316L20.5 2.22165L5.5 11.5316V29.9684L20.5 39.2783L35.5 29.9684V11.5316Z" stroke="#10A37F" stroke-width="3.5"></path>
                                <path d="M28.998 15.79L20.5 20.75L12 15.79M20.5 32V20.75" stroke="#10A37F" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </a>
                        <a href="#" class="model-option flex items-center justify-between px-4 py-2 text-sm font-bold text-[#B0B0B0] bg-[#3a3b3c]"><span>llama3-70b-8192</span><i class="fa-brands fa-meta text-blue-500"></i></a>
                    </div>
                </div>
            </div>
            
            <!-- Right Side: Credential Icons -->
            <div class="flex items-center gap-6">
                <!-- Resume Link -->
                <a href="https://drive.google.com/drive/folders/1yqqZpT7_QyB4PQrM9rh7XpYzeuyGq-pR?dmr=1&ec=wgc-drive-globalnav-goto" target="_blank" rel="noopener noreferrer" class="flex flex-col items-center text-gray-400 hover:text-white transition-colors" title="View Resume">
                    <i class="fa-solid fa-user-doctor text-2xl h-6"></i>
                    <span class="text-xs mt-1">Resume</span>
                </a>
                <!-- Email Link -->
                <a href="mailto:adityajayashankar@gmail.com" class="flex flex-col items-center text-gray-400 hover:text-white transition-colors" title="Contact Email">
                    <i class="fa-brands fa-mailchimp text-2xl h-6"></i>
                    <span class="text-xs mt-1">Email</span>
                </a>
                <!-- GitHub Link -->
                <a href="https://github.com/adityajayashankar" target="_blank" rel="noopener noreferrer" class="flex flex-col items-center text-gray-400 hover:text-white transition-colors" title="View Source on GitHub">
                    <i class="fa-brands fa-github text-2xl h-6"></i>
                    <span class="text-xs mt-1">GitHub</span>
                </a>
            </div>
        </header>

        <!-- Chat Window -->
        <div id="chat-window" class="flex-1 overflow-y-auto p-4">
            <!-- Messages will be appended here -->
        </div>

        <!-- Input Area -->
        <div class="w-full bg-gradient-to-t from-[#1b1c1d] via-40% via-[#1b1c1d] to-transparent sticky bottom-0">
            <footer class="mx-auto px-4 pt-4 pb-2">
                <div class="relative flex items-center">
                    <input type="text" id="user-input" placeholder="Ask Nyla about health topics..." class="w-full bg-[#272829] text-[#E0E0E0] placeholder:text-gray-500 rounded-xl border border-white/10 focus:border-white/20 py-3 pl-4 pr-12 shadow-lg focus:outline-none transition-colors duration-300" autocomplete="off">
                    <button id="send-btn" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-200 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </div>
                 <p class="text-xs text-gray-500 text-center mt-3 px-4">
                    AI assistant for informational purposes only. Not medical advice. Consult a professional for health concerns.
                </p>
            </footer>
        </div>
    </div>

    <script>
        // DOM element references
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const modelSelectorBtn = document.getElementById('model-selector-btn');
        const modelDropdown = document.getElementById('model-dropdown');
        const selectedModel = document.getElementById('selected-model');

        // --- Core Chat Logic ---

        function appendMessage(message, sender) {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('w-full', 'py-6', 'flex', 'justify-center');

            const contentWrapper = document.createElement('div');
            contentWrapper.classList.add('flex', 'gap-4', 'w-full', 'px-4');

            const icon = document.createElement('div');
            icon.classList.add('w-8', 'h-8', 'flex-shrink-0', 'rounded-full', 'flex', 'items-center', 'justify-center', 'text-white');

            const messageBubble = document.createElement('div');
            messageBubble.classList.add('text-[#E0E0E0]', 'prose', 'prose-invert', 'max-w-none');
            
            if (sender === 'user') {
                messageWrapper.style.backgroundColor = '#1b1c1d';
                icon.style.backgroundColor = '#1E1F21';
                icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`;
            } else { // bot
                messageWrapper.style.backgroundColor = '#272829';
                messageWrapper.classList.add('border-t', 'border-b', 'border-black/20');
                icon.classList.add('bg-teal-600');
                icon.innerHTML = `<i class="fa-solid fa-virus"></i>`;
            }

            messageBubble.innerHTML = message;
            
            contentWrapper.appendChild(icon);
            contentWrapper.appendChild(messageBubble);
            messageWrapper.appendChild(contentWrapper);
            chatWindow.appendChild(messageWrapper);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        /**
         * Gets a response from the Flask backend.
         * @param {string} userMessage - The user's message.
         */
        async function getBotResponse(userMessage) {
            const typingIndicator = showTypingIndicator();
            
            try {
                // This now points to your Flask '/get' route
                const response = await fetch('/get', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: userMessage }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                // This now expects the "answer" key from your Flask response
                const botMessage = data.answer; 

                hideTypingIndicator(typingIndicator);
                appendMessage(botMessage, 'bot');

            } catch (error) {
                console.error("Error fetching bot response:", error);
                hideTypingIndicator(typingIndicator);
                const errorMessage = "<p>Sorry, something went wrong and I couldn't connect to the server. Please try again later.</p>";
                appendMessage(errorMessage, 'bot');
            }
        }
        
        function showTypingIndicator() {
            const message = `<div class="flex items-center space-x-1">
                                <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: -0.3s;"></span>
                                <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style="animation-delay: -0.15s;"></span>
                                <span class="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></span>
                            </div>`;
            appendMessage(message, 'bot');
            return chatWindow.lastElementChild;
        }

        function hideTypingIndicator(indicator) {
            if (indicator) {
               indicator.remove();
            }
        }

        function sendMessage() {
            const message = userInput.value.trim();
            if (message) {
                appendMessage(message, 'user');
                userInput.value = '';
                getBotResponse(message);
            }
        }
        
        // --- Event Listeners ---
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        });

        // --- Model Selector Logic ---
        modelSelectorBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            modelDropdown.classList.toggle('hidden');
        });

        window.addEventListener('click', () => {
            if (!modelDropdown.classList.contains('hidden')) {
                modelDropdown.classList.add('hidden');
            }
        });

        modelDropdown.addEventListener('click', (event) => {
            event.preventDefault();
            const target = event.target.closest('.model-option');
            if (target) {
                const newModel = target.querySelector('span').textContent; // Updated to get text from span
                selectedModel.textContent = newModel;
                modelDropdown.classList.add('hidden');
                
                document.querySelectorAll('.model-option').forEach(opt => {
                    opt.classList.remove('bg-[#3a3b3c]', 'text-[#B0B0B0]');
                    opt.classList.add('text-[#E0E0E0]');
                });
                target.classList.add('bg-[#3a3b3c]', 'text-[#B0B0B0]');
                target.classList.remove('text-[#E0E0E0]');
            }
        });
        
        // --- Initial Welcome Message ---
        window.onload = () => {
             const welcomeMessage = `
                <p class="font-semibold text-lg mb-2">Welcome! I'm Nyla.</p>
                <p>I can provide general information on common health topics. Please note, I am not a substitute for a real doctor.</p>
            `;
            setTimeout(() => {
                appendMessage(welcomeMessage, 'bot');
            }, 500);
        };

    </script>
</body>
</html>
